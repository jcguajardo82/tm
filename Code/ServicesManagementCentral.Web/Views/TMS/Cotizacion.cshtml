

@{
    ViewBag.Title = "Cotizacion";
}

<style>
    #radioBtn .notActive {
        color: #3276b1;
        background-color: #fff;
    }

    .red {
        background-color: red !important;
    }

    #table-scroll {
        height: 600px;
        overflow: auto;
        margin-top: 20px;
    }

    .modalPdfContainer {
        width: 100%;
        height: calc(100vh);
    }
</style>

@using (Html.BeginForm())
{
    <div class="row">
        <div class="col-4"></div>
        <div class="col-4"><h2>Cotizacion de guias</h2></div>
        <div class="col-4"></div>
    </div>


    <div class="ibox-content p-xl" style="padding-top: 0px;padding-bottom: 0px;">
        @*<h1><a href="#" class="btn btn-primary alert-custom">Bootbox Dialog &nbsp;<i class="glyphicon glyphicon-hand-left"></i></a></h1>*@
        <br />
        <div class="row">
            <div class="col col-xs-8 col-md-3">
                <div class="form-group">
                    <label>Proveedor:</label>
                    <select class="form-control" id="ProveedorLista" name="ProveedorLista">
                        <option selected="selected" value="0">--Seleccionar--</option>
                        <option value="1">Estafeta</option>
                        <option value="2">Envia Ya</option>
                    </select>
                </div>
            </div>
            <div class="col col-xs-8 col-md-3">
                <div class="form-group">
                    <label>Orden de Venta</label>
                    <input type="text" placeholder="Orden de Venta" id="NoOrder" name="NoOrder" class="form-control" />
                </div>
            </div>
            <div class="col col-xs-8 col-md-3">
                <div class="form-group">
                    <label>Pedido (Consignación)</label>
                    <input type="text" placeholder="Pedido" id="UeNo" name="Ue No" class="form-control" />
                </div>
            </div>
            <div class="col-md-3">
                <button class="btn btn-danger mt-4" type="button" onclick="btnOrdenes();"><i class="fa fa-search"></i>&nbsp;&nbsp;<span class="bold"></span></button>

            </div>
        </div>

        <br />

        @*<table id="tblConsulta" class="table table-striped dataTable" style="width:100%">*@
        <div class="row" id="dualListInvs" style="margin-left: 1%;margin-right: 1%;overflow-x: scroll;">
            <div class="row" id="gridInvs">
                <br />
                <div class="col-12">

                    <table id="tblConsulta" class="table table-striped table-bordered table-hover" style="overflow: scroll;width: 100%">
                        <thead>
                            <tr>
                                <th>Descripcion<br />Servicio</th>
                                <th>Tipo<br />EnvioRes</th>
                                <th>Aplica<br />Cotizacion</th>
                                <th>Tarifa<br />Base</th>
                                <th>CCTarifa<br />Base</th>
                                <th>Cargos<br />Extra</th>
                                <th>SobrePeso</th>
                                <th>CCSobrePeso</th>
                                <th>Costo<br />Total</th>
                                <th>Peso</th>
                                <th>Aplica<br />Servicio</th>
                                <th>Usuario Creacion</th>
                                <th>Fecha Creacion</th>
                                <th>Hora Creacion</th>
                                <th>Activo</th>
                                <th></th>


                            </tr>
                        </thead>
                        <tbody></tbody>
                        @*<tfoot>
                                <tr>
                                    <th>DescripcionServicio</th>
                                    <th>TipoEnvioRes</th>
                                    <th>AplicaCotizacion</th>
                                    <th>TarifaBase</th>
                                    <th>CCTarifaBase</th>
                                    <th>CargosExtra</th>
                                    <th>SobrePeso</th>
                                    <th>CCSobrePeso</th>
                                    <th>CostoTotal</th>
                                    <th>Peso</th>
                                    <th>AplicaServicio</th>
                                </tr>
                            </tfoot>*@
                    </table>

                </div>
            </div>
        </div>


        <div id="frmAltaTrans" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">Alta de Transportistas</h2>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="frmCreateServicios">
                            @*<div class="row">
                                    <div class="col col-xs-8 col-md-12">
                                        <div class="form-group">
                                            <label>Transportista</label>
                                            <select class="form-control" id="ProveedorLista" name="ProveedorLista">
                                                <option selected="selected" value="0">--Transportista--</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>*@
                            <div class="row">
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>C.P. ORIGEN</label>
                                        <input type="text" placeholder="C.P. ORIGEN" id="cp_origen" name="cp_origen" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">

                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>C.P. DESTINO</label>
                                        <input type="text" placeholder="C.P. DESTINO" id="cp_destino" name="cp_destino" class="form-control" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>LARGO</label>
                                        <input type="text" placeholder="LARGO" id="in_largo" name="in_largo" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>PESO</label>
                                        <input type="text" placeholder="PESO" id="in_peso" name="in_peso" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>ALTO</label>
                                        <input type="text" placeholder="ALTO" id="in_alto" name="in_alto" class="form-control" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">

                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>ANCHO</label>
                                        <input type="text" placeholder="ANCHO" id="in_ancho" name="in_ancho" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    @*<div class="form-group">
                                            <label>Porc. Adic. Paquete</label>
                                            <input type="text" placeholder="Porc. Adic. Paquete" id="PorcAdicPaquete" name="PorcAdicPaquete" class="form-control" />
                                        </div>*@
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Es paquete</label>
                                        <div class="input-group">
                                            <div id="radioBtn" class="btn-group">
                                                <a class="btn btn-primary btn-sm active" data-toggle="TarifaFija" data-title="Y">SI</a>
                                                <a class="btn btn-primary btn-sm notActive" data-toggle="TarifaFija" data-title="N">NO</a>
                                            </div>
                                            <input type="hidden" name="TarifaFija" id="TarifaFija">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @*<div class="row">
                                    <div class="col col-xs-8 col-md-3">
                                        <div class="form-group">
                                            <label>Paqueteria</label>
                                            <div class="input-group">
                                                <div id="radioBtn" class="btn-group">
                                                    <a class="btn btn-primary btn-sm active" data-toggle="Paqueteria" data-title="Y">SI</a>
                                                    <a class="btn btn-primary btn-sm notActive" data-toggle="Paqueteria" data-title="N">NO</a>
                                                </div>
                                                <input type="hidden" name="Paqueteria" id="Paqueteria">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col col-xs-8 col-md-3">
                                        <div class="form-group">
                                            <label>Big Ticket</label>
                                            <div class="input-group">
                                                <div id="radioBtn" class="btn-group">
                                                    <a class="btn btn-primary btn-sm active" data-toggle="BigTicket" data-title="Y">SI</a>
                                                    <a class="btn btn-primary btn-sm notActive" data-toggle="BigTicket" data-title="N">NO</a>
                                                </div>
                                                <input type="hidden" name="BigTicket" id="BigTicket">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col col-xs-8 col-md-3">
                                        <div class="form-group">
                                            <label>Servicio Estandar</label>
                                            <div class="input-group">
                                                <div id="radioBtn" class="btn-group">
                                                    <a class="btn btn-primary btn-sm active" data-toggle="ServicioEstandar" data-title="Y">SI</a>
                                                    <a class="btn btn-primary btn-sm notActive" data-toggle="ServicioEstandar" data-title="N">NO</a>
                                                </div>
                                                <input type="hidden" name="ServicioEstandar" id="ServicioEstandar">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col col-xs-8 col-md-3">
                                        <div class="form-group">
                                            <label>Servicio Express</label>
                                            <div class="input-group">
                                                <div id="radioBtn" class="btn-group">
                                                    <a class="btn btn-primary btn-sm active" data-toggle="ServicioExpress" data-title="Y">SI</a>
                                                    <a class="btn btn-primary btn-sm notActive" data-toggle="ServicioExpress" data-title="N">NO</a>
                                                </div>
                                                <input type="hidden" name="ServicioExpress" id="ServicioExpress">
                                            </div>
                                        </div>
                                    </div>
                                </div>*@
                        </form>
                    </div>

                    <div class="modal-footer">

                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button type="button" onclick="AddSurtidores()" class="btn btn-primary">Guardar</button>
                    </div>

                </div>
            </div>
        </div>

        <div id="buscaOrden" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">Lista de Ordenes</h2>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <table id="Table_Inv" class="table table-striped table-bordered table-hover" style="overflow: scroll">
                            <thead>
                                <tr>
                                    <th>OrderNo</th>
                                    <th>UeNo</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>

                                @{

                                    if (Session["lisOrdenes"] != null)
                                    {

                                        var myDataSet = Session["lisOrdenes"] as System.Data.DataSet;
                                        foreach (System.Data.DataRow r in myDataSet.Tables[0].Rows)
                                        {
                                            <tr>
                                                <td>
                                                    @r["OrderNo"]
                                                </td>
                                                <td>
                                                    @r["UeNo"]
                                                </td>
                                                <td>
                                                    <button type="button" onclick="SelectOrder('@r["OrderNo"]','@r["UeNo"]')" class="btn btn-warning btn-circle"> <i class="fa fa-minus"></i></button>
                                                </td>
                                            </tr>

                                        }
                                    }
                                }

                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">

                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button type="button" onclick="AddSurtidores()" class="btn btn-primary">Guardar</button>
                    </div>

                </div>
            </div>
        </div>


        <div class="modal fade bd-example-modal-lg" id="myProduccion" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="height:650px">
                    <div class="modal-header">
                        <h5 class="modal-title">Reporte de Consulta de Asignacion de Dueño de Pasillo</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <iframe width="100%" height="550px" id="frameReporte" src="" frameborder="0" allowfullscreen></iframe>

                    </div>

                </div>
            </div>
        </div>


        <div class="modal fade bd-example-modal-lg" id="dlgReporteador" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="titleReporteador">Mostrando el reporte</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="position:inherit">
                            <div class="lockPdf"></div>
                            <embed class="modalPdfContainer" src="data:application/pdf;base64,'" type="application/pdf" id="objPDF" />
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <input id="filename" name="filename" value="0" style="visibility:hidden" />

        <input id="flagStatus" name="flagStatus" value="" style="visibility:hidden" />

    </div>
}
@section scripts {

    <link href="~/Content/plugins/datatables/datatables.css" rel="stylesheet" />
    <script src="~/Content/plugins/datatables/datatables.min.js"></script>
    <script src="~/Content/plugins/datatables/datatables.js"></script>
    <script src="~/Scripts/bootbox.js"></script>
    <script src="~/Scripts/bootbox.min.js"></script>

    <script>
        function changeSrcEmbed(element, src) {
            var id = element.id;
            element.src = src;
            var embedOld = document.getElementById(id);
            var parent = embedOld.parentElement;
            var newElement = element;
            document.getElementById(id).remove();
            //parent.append(newElement);
            parent.appendChild(newElement);

        }


        function SelectOrder(orden,ue) {

            document.getElementById("NoOrder").value = orden;
            document.getElementById("UeNo").value = ue;

            $("#buscaOrden").modal('hide');
        }

        function btnOrdenes() {

            $("#buscaOrden").modal('show');

        }

        $('#radioBtn a').on('click', function () {
            var sel = $(this).data('title');
            var tog = $(this).data('toggle');
            $('#' + tog).prop('value', sel);

            $('a[data-toggle="' + tog + '"]').not('[data-title="' + sel + '"]').removeClass('active').addClass('notActive');
            $('a[data-toggle="' + tog + '"][data-title="' + sel + '"]').removeClass('notActive').addClass('active');
        })


        $(document).ready(function () {

            $('input[type=checkbox]').change(function () { alert(document.getElementById("id_TS").value) });



            $('#Table_Inv').DataTable(
                {

                    language:
                    {
                        "sProcessing": "Procesando...",
                        "sLengthMenu": "Mostrar _MENU_ registros",
                        "sZeroRecords": "No se encontraron resultados",
                        "sEmptyTable": "Ningún dato disponible en esta tabla",
                        "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "sInfoPostFix": "",
                        "sSearch": "Buscar:",
                        "sUrl": "",
                        "sInfoThousands": ",",
                        "sLoadingRecords": "Cargando...",
                        "oPaginate": {
                            "sFirst": "Primero",
                            "sLast": "Último",
                            "sNext": "Siguiente",
                            "sPrevious": "Anterior"

                        },
                        "oAria": {
                            "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sSortDescending": ": Activar para ordenar la columna de manera descendente"

                        },
                        "buttons": {
                            "print": "Imprimir",
                            "pageLength": 'Mostrar %d Registros'

                        }
                    },
                    dom: 'Bfrtip',
                    lengthMenu: [
                        [10, 25, 50, -1],
                        ['10 Registros', '25 Registros', '50 Registros', 'Mostrar Todos']
                    ],
                    buttons: [
                        { extend: 'pageLength', className: 'btn-primary' },
                        { extend: 'excel', className: 'btn-primary' }

                    ]
                    //,"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    //    if (aData[1] == "SETC") {
                    //        $('td', nRow).css('background-color', '#B6BF00');
                    //    } else if (aData[2] == "4") {
                    //        $('td', nRow).css('background-color', 'Orange');
                    //    }
                    //}
                }
            );

            $('#tblConsulta').DataTable(
                {

                    language:
                        {
                            "sProcessing": "Procesando...",
                            "sLengthMenu": "Mostrar _MENU_ registros",
                            "sZeroRecords": "No se encontraron resultados",
                            "sEmptyTable": "Ningún dato disponible en esta tabla",
                            "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                            "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                            "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                            "sInfoPostFix": "",
                            "sSearch": "Buscar:",
                            "sUrl": "",
                            "sInfoThousands": ",",
                            "sLoadingRecords": "Cargando...",
                            "oPaginate": {
                                "sFirst": "Primero",
                                "sLast": "Último",
                                "sNext": "Siguiente",
                                "sPrevious": "Anterior"

                            },
                            "oAria": {
                                "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                                "sSortDescending": ": Activar para ordenar la columna de manera descendente"

                            },
                            "buttons": {
                                "print": "Imprimir",
                                "pageLength": 'Mostrar %d Registros'

                            }
                        },
                    dom: 'Bfrtip',
                    lengthMenu: [
                                    [10, 25, 50, -1],
                                     ['10 Registros', '25 Registros', '50 Registros', 'Mostrar Todos']
                    ],
                    buttons: [
                            { extend: 'pageLength', className: 'btn-primary' },
                            { extend: 'excel', className: 'btn-primary' },
                            {
                                text: 'Cotizacion',
                                action: function (e, dt, node, config) {
                                    //var e = document.getElementById("ProveedorLista");
                                    //e.disabled = false;

                                    document.getElementById("TarifaFija").value = "SI";
                                    document.getElementById("cp_origen").value = '';
                                    document.getElementById("cp_destino").value = '';
                                    document.getElementById("in_ancho").value = '';
                                    document.getElementById("in_alto").value = '';
                                    document.getElementById("in_peso").value = '';
                                    document.getElementById("in_largo").value = '';

                                    $("#frmAltaTrans").modal('show');

                                }
                                , className: 'btn-primary'
                            }
                    ]
                    //,"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    //    if (aData[1] == "SETC") {
                    //        $('td', nRow).css('background-color', '#B6BF00');
                    //    } else if (aData[2] == "4") {
                    //        $('td', nRow).css('background-color', 'Orange');
                    //    }
                    //}
                }
            );

            //GetTrans();
            //GetCommonProveedor();
        });

        function GetCommonProveedor() {

            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetCommonProveedores", "Catalogo")',
                data: {
                    IdAlmacen: null
                },
                datatype: "html",
                success: function (json) {
                    if (json.Success) {
                        console.log(json);
                        var dynamicSelect = document.getElementById("ProveedorLista");
                        dynamicSelect.innerText = null;
                        console.log(dynamicSelect);
                        for (var i = 0; i < json.json.length; i++) {
                            var newOption = document.createElement("option");
                            newOption.value = json.json[i].NumProveedor;
                            newOption.textContent = json.json[i].NombreProveedor;//item.whateverProperty

                            dynamicSelect.appendChild(newOption);
                        }
                        console.log(dynamicSelect);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function EditSurtidores(IdTransportista) {

            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetTransportistas", "Catalogo")',
                data: {
                    IdTransportista: parseInt(IdTransportista)
                },
                datatype: "html",
                success: function (json) {
                    //debugger;
                    if (json.Success) {
                        console.log(json);
                        for (var i = 0; i < json.json.length; i++) {
                            //document.getElementById("IdTransportista").value = json.json[i].IdTransportista;
                            //document.getElementById("RazonSocial").value = json.json[i].RazonSocial;
                            var e = document.getElementById("ProveedorLista");
                            e.value = json.json[i].IdTransportista;
                            e.disabled = true;

                            var valTarifaFija = (json.json[i].TarifaFija == true) ? "Y" : "N";
                            document.getElementById("CostoTarifaFija").value = json.json[i].CostoTarifaFija;
                            document.getElementById("NivelServicio").value = json.json[i].NivelServicio;
                            document.getElementById("FactorVoluntario").value = json.json[i].FactorVoluntario;
                            document.getElementById("PorcAdicPaquete").value = json.json[i].PorcAdicPaquete;
                            document.getElementById("Prioridad").value = json.json[i].Prioridad;
                            var valPaqueteria = (json.json[i].Paqueteria == true) ? "Y" : "N";
                            var valBigTicket = (json.json[i].BigTicket == true) ? "Y" : "N";
                            var valServicioEstandar = (json.json[i].ServicioEstandar == true) ? "Y" : "N";
                            var valServicioExpress = (json.json[i].ServicioExpress == true) ? "Y" : "N";
                        }

                        $('a[data-toggle="TarifaFija"][data-title="' + valTarifaFija + '"]').click();
                        $('a[data-toggle="Paqueteria"][data-title="' + valPaqueteria + '"]').click();
                        $('a[data-toggle="BigTicket"][data-title="' + valBigTicket + '"]').click();
                        $('a[data-toggle="ServicioEstandar"][data-title="' + valServicioEstandar + '"]').click();
                        $('a[data-toggle="ServicioExpress"][data-title="' + valServicioExpress + '"]').click();

                        $("#frmAltaTrans").modal('show');
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function AddSurtidores() {
            var _TarifaFija = document.getElementById("TarifaFija").value;

            debugger;
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetCotizacion", "TMS")',
                data: {
                    paquete: (_TarifaFija == "Y") ? true : false,
                    cp_o: document.getElementById("cp_origen").value,
                    cp_d: document.getElementById("cp_destino").value,
                    alto: document.getElementById("in_alto").value,
                    ancho: document.getElementById("in_ancho").value,
                    largo: document.getElementById("in_largo").value,
                    peso: document.getElementById("in_peso").value,
                },
                datatype: "json",
                success: function (json) {
                    if (json.Success) {
                        debugger;
                        //alert(json.json.cotizacion.TipoServicio[0].DescripcionServicio);

                        var table1 = $('#tblConsulta').DataTable();
                        table1.clear().draw();
                        table1.destroy();


                        var table = $('#tblConsulta').DataTable(
                            {

                                language:
                                {
                                    "sProcessing": "Procesando...",
                                    "sLengthMenu": "Mostrar _MENU_ registros",
                                    "sZeroRecords": "No se encontraron resultados",
                                    "sEmptyTable": "Ningún dato disponible en esta tabla",
                                    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                                    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                                    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                                    "sInfoPostFix": "",
                                    "sSearch": "Buscar:",
                                    "sUrl": "",
                                    "sInfoThousands": ",",
                                    "sLoadingRecords": "Cargando...",
                                    "oPaginate": {
                                        "sFirst": "Primero",
                                        "sLast": "Último",
                                        "sNext": "Siguiente",
                                        "sPrevious": "Anterior"

                                    },
                                    "oAria": {
                                        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                                        "sSortDescending": ": Activar para ordenar la columna de manera descendente"

                                    },
                                    "buttons": {
                                        "print": "Imprimir",
                                        "pageLength": 'Mostrar %d Registros'

                                    }
                                },
                                dom: 'Bfrtip',
                                lengthMenu: [
                                    [10, 25, 50, -1],
                                    ['10 Registros', '25 Registros', '50 Registros', 'Mostrar Todos']
                                ],
                                buttons: [
                                    { extend: 'pageLength', className: 'btn-primary' },
                                    { extend: 'excel', className: 'btn-primary' },
                                    {
                                        text: 'Cotizacion',
                                        action: function (e, dt, node, config) {
                                            //var e = document.getElementById("ProveedorLista");
                                            //e.disabled = false;

                                            document.getElementById("TarifaFija").value = "SI";
                                            document.getElementById("cp_origen").value = '';
                                            document.getElementById("cp_destino").value = '';
                                            document.getElementById("in_ancho").value = '';
                                            document.getElementById("in_alto").value = '';
                                            document.getElementById("in_peso").value = '';
                                            document.getElementById("in_largo").value = '';

                                            $("#frmAltaTrans").modal('show');

                                        }
                                        , className: 'btn-primary'
                                    },
                                    {
                                        text: 'Guardar Cotizacion',
                                        action: function (e, dt, node, config) {
                                            saveCotizacion()
                                        }
                                        , className: 'btn-primary'
                                    }

                                ]
                                //,"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                                //    if (aData[1] == "SETC") {
                                //        $('td', nRow).css('background-color', '#B6BF00');
                                //    } else if (aData[2] == "4") {
                                //        $('td', nRow).css('background-color', 'Orange');
                                //    }
                                //}
                            }
                        );

                        //table.clear().draw();
                        //table.destroy();

                        for (var i = 0; i < json.json.cotizacion.TipoServicio.length; i++) {


                            table.row.add([
                                json.json.cotizacion.TipoServicio[i].DescripcionServicio,
                                json.json.cotizacion.TipoServicio[i].TipoEnvioRes,
                                json.json.cotizacion.TipoServicio[i].AplicaCotizacion,
                                json.json.cotizacion.TipoServicio[i].TarifaBase,
                                json.json.cotizacion.TipoServicio[i].CCTarifaBase,
                                json.json.cotizacion.TipoServicio[i].CargosExtra,
                                json.json.cotizacion.TipoServicio[i].SobrePeso,
                                json.json.cotizacion.TipoServicio[i].CCSobrePeso,
                                json.json.cotizacion.TipoServicio[i].CostoTotal,
                                json.json.cotizacion.TipoServicio[i].Peso,
                                json.json.cotizacion.TipoServicio[i].AplicaServicio,
                                "",
                                "",
                                "",
                                ""
                                /*, "<input id=\"radio_TS\" name=\"tipoS\" type=\"radio\" onchange=\"setTS('" + json.json.cotizacion.TipoServicio[i].DescripcionServicio + "')\"  value=\"" + json.json.cotizacion.TipoServicio[i].DescripcionServicio + "\">"*/
                                /*, "<button type=\"button\" onclick=\"DeleteSurtidores(undefined)\" class=\"btn btn-warning btn-circle\"> <i class=\"fa fa-pencil\"></i></button>"*/
                                , "<button type=\"button\" onclick=\"GeneraGuia(" + json.json.cotizacion.TipoServicio[i].DescripcionServicio+")\" class=\"btn btn-warning btn-circle\"> <i class=\"fa fa-pencil\"></i></button>"

                            ]).draw();

                        }


                        $("#frmAltaTrans").modal('hide');


                    } else { alert(json.Message);}
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function GeneraGuia(desc) {

             $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GeneraGuia", "TMS")',
                data: {
                    UeNo: document.getElementById("UeNo").value,
                    OrderNo: document.getElementById("NoOrder").value,
                    tipoServicio: desc, //document.getElementById("flagStatus").value,
                    paqueteria: "1"

                },
                datatype: "html",
                success: function (json) {
                    //debugger;
                    if (json.Success) {

                        alert("Cotizacion Guardada con exito");


                        @*$('#frameReporte').attr('src', '@Url.Action("DownLoad", "IntegridadAnaquel")?filename=' + data.Object.ruta);

                        $('#myProduccion').modal('show');*@


                        var element = document.getElementById('objPDF');
                        changeSrcEmbed(element, 'data:application/pdf;base64,' + json.pdf);//+ '#toolbar=0&navpanes=0&scrollbar=0');
                        $('#dlgReporteador').modal('show');
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function DisplayError(xhr) {

            if (xhr.responseText == "Solicitud incorrecta") {
                var msg = JSON.parse(xhr.statusText);
                bootbox.alert("<h4>" + msg + "</h4>");
            }
            else {
                var msg = JSON.parse(xhr.responseText);
                bootbox.alert("<h4>" + msg.Message + "</h4>");
            }
        }


        function setTS(servicio) {

            //$('input:checkbox').prop('checked', false)
            debugger;
            var nameChk = "#chk_" + document.getElementById("flagStatus").value.replace(/\s+/g, '');

            $(nameChk).prop("checked", false);

            document.getElementById("flagStatus").value = servicio;

        }

        function articulo(codigo, descripcion, unidad) {
            this.Codigo = codigo;
            this.Descripcion = descripcion;
            this.Unidad = unidad;
        }

        function captura(guid, codigo, cantidad) {
            this.idCaptura = 0;
            this.guid = guid;
            this.Codigo = codigo;
            this.Cantidad = cantidad;
        }


        function cotizacion(DescripcionServicio
                            ,TipoEnvioRes
                            ,AplicaCotizacion
                            ,TarifaBase
                            ,CCTarifaBase
                            ,CargosExtra
                            ,SobrePeso
                            ,CCSobrePeso
                            ,CostoTotal
                            ,Peso
                            ,AplicaServicio) {

            this.DescripcionServicio = DescripcionServicio
            this.TipoEnvioRes = TipoEnvioRes
            this.AplicaCotizacion = AplicaCotizacion
            this.TarifaBase = TarifaBase
            this.CCTarifaBase = CCTarifaBase
            this.CargosExtra = CargosExtra
            this.SobrePeso = SobrePeso
            this.CCSobrePeso = CCSobrePeso
            this.CostoTotal = CostoTotal
            this.Peso = Peso
            this.AplicaServicio = AplicaServicio

        }

        function saveCotizacion() {

            debugger;

            alert("TS" + document.getElementById("flagStatus").value);


            var dtTable12 = $('#tblConsulta').DataTable();

            var catalogo = [];
            var capturas = [];

            dtTable12.rows().data().toArray().forEach(function (row) {
                var item = {}
                debugger;
                lastInventoryCapture = new cotizacion(row[0]
                            , row[1]
                            , row[2]
                            , row[3]
                            , row[4]
                            , row[5]
                            , row[6]
                            , row[7]
                            , row[8]
                            , row[9]
                            , row[10]);

                capturas.push(lastInventoryCapture);

                //var indexC = 0;
                //row.forEach(function (content, index) {
                //    item[fieldNames[index]] = content;


                //    indexC++;
                //})
                //json2.push(item)
            })
            debugger;
            //alert('capturas' + JSON.stringify(capturas));

            //var data = dtTable12.rows().data().toArray();
            //var json = JSON.stringify(data);

            //alert(json);

            //alert($('#tblConsulta').DataTable().rows().data().toArray());


            @*$.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("SaveCotizacion", "TMS")',
                data: {
                    jsonData: JSON.stringify(capturas)
                },
                datatype: "html",
                success: function (json) {
                    //debugger;
                    if (json.Success) {

                        alert("Cotizacion Guardada con exito");

                    }
                }
               , error: function (jqXHR, textStatus, errorThrown) {
                   bootbox.alert(errorThrown);
               }
            });*@

        }



        //<th>Id Transportista</th>
        //<th>Tarifa Fija</th>
        //<th>Prioridad</th>
        //<th>Nivel de Servicio</th>
        //<th>Factor Division<br /> Peso Voluntario </th>
        //<th>Paqueteria</th>
        //<th>Big Ticket</th>
        //<th>Servicio Estandar</th>
        //<th>Servicio Express</th>
        function GetTrans() {
            //var _Id_Num_UN = $("#hddTda").val();
            //debugger;
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetTransportistas", "Catalogo")',
                data: {
                    //  Id_Num_UN: _Id_Num_UN
                },
                datatype: "html",
                success: function (json) {
                    if (json.Success) {
                        $("#tblConsulta tbody tr").remove();
                        //var tr;
                        //debugger;
                        //Append each row to html table
                        console.log(json);
                        for (var i = 0; i < json.json.length; i++) {
                            tr = $('<tr/>');
                            //tr.append("<td class='row1'>" + json.json[i].Id_Num_Orden + "</td>");
                            tr.append("<td>" + json.json[i].IdTransportista + "</td>");
                            //tr.append("<td>" + json.json[i].RazonSocial + "</td>");
                            if (json.json[i].TarifaFija == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }

                            tr.append("<td>" + json.json[i].Prioridad + "</td>");
                            tr.append("<td>" + json.json[i].NivelServicio + "</td>");
                            tr.append("<td>" + json.json[i].FactorPaqueteria + "</td>");
                            if (json.json[i].Paqueteria == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            if (json.json[i].BigTicket == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            if (json.json[i].ServicioEstandar == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            if (json.json[i].ServicioExpress == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            //tr.append("<td><button type = 'button' class= 'btn btn-white btn-circle'> <i class='fa fa-edit'></i></button><button type='button' class='btn btn-warning btn-circle'> <i class='fa fa-minus'></i></button></td >")
                            tr.append("<td><button onclick='EditSurtidores(" + json.json[i].IdTransportista + ")' type = 'button' class= 'btn btn-white btn-circle'> <i class='fa fa-edit'></i></button><button type='button'  onclick='DeleteSurtidores(" + json.json[i].Id_Carrier + ")'  class='btn btn-warning btn-circle'> <i class='fa fa-minus'></i></button></td >")
                            $('#tblConsulta').append(tr);

                        }
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        /* Bootbox Dialog box with custom Value */
        $('.alert-custom').click(function () {
            bootbox.dialog({
                title: "This is a form in a modal.",
                message: '<div class="row">  ' +
                '<div class="col-md-12"> ' +
                '<form class="form-horizontal"> ' +
                '<div class="form-group"> ' +
                '<label class="col-md-4 control-label" for="name">Name</label> ' +
                '<div class="col-md-4"> ' +
                '<input id="name" name="name" type="text" placeholder="Your name" class="form-control input-md"> ' +
                '<span class="help-block">Here goes your name</span> </div> ' +
                '</div> ' +
                '<div class="form-group"> ' +
                '<label class="col-md-4 control-label" for="awesomeness">How awesome is this?</label> ' +
                '<div class="col-md-4"> <div class="radio"> <label for="awesomeness-0"> ' +
                '<input type="radio" name="awesomeness" id="awesomeness-0" value="Really awesome" checked="checked"> ' +
                'Really awesome </label> ' +
                '</div><div class="radio"> <label for="awesomeness-1"> ' +
                '<input type="radio" name="awesomeness" id="awesomeness-1" value="Super awesome"> Super awesome </label> ' +
                '</div> ' +
                '</div> </div>' +
                '</form> </div>  </div>',
                buttons: {
                    success: {
                        label: "Save",
                        className: "btn-success",
                        callback: function () {
                            var name = $('#name').val();
                            var answer = $("input[name='awesomeness']:checked").val()
                            $('.Example').show().html("Hello " + name + ". You've chosen <b>" + answer + "</b").fadeOut(5000);
                        }
                    }
                }
            }
                    );
        })
    </script>
}
