
@{
    ViewBag.Title = "Tipo de Logistica";
}

<style>
    #radioBtn .notActive {
        color: #3276b1;
        background-color: #fff;
    }

    .red {
        background-color: red !important;
    }

    #table-scroll {
        height: 600px;
        overflow: auto;
        margin-top: 20px;
    }

    .modalPdfContainer {
        width: 100%;
        height: calc(100vh);
    }
</style>

@using (Html.BeginForm())
{
    <div class="row">
        <div class="col-4"></div>
        <div class="col-4"><h2>Tipo de Logistica</h2></div>
        <div class="col-4"></div>
    </div>


    <div class="ibox-content p-xl" style="padding-top: 0px;padding-bottom: 0px;">
        <br />

        @*<table id="tblConsulta" class="table table-striped dataTable" style="width:100%">*@
        <div class="row" id="dualListInvs" style="margin-left: 1%;margin-right: 1%;overflow-x: scroll;">
            <div class="row" id="gridInvs">
                <br />
                <div class="col-12">

                    <table id="tblConsulta" class="table table-striped table-bordered table-hover" style="overflow: scroll;width: 100%">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Logistica</th>
                                <th>Min. Peso kg/Volumetrico</th>
                                <th>Max. Peso kg/Volumetrico</th>
                                <th>Maximo de costo de envío</th>
                                <th>Tipo de Articulo</th>
                                <th>Usuario de Actualizacion</th>
                                <th>Fecha de Actualizacion</th>
                                <th>Hora de Actualizacion</th>
                                <th>Activo</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>

                            @{

                                if (Session["listaTL"] != null)
                                {

                                    var myDataSet = Session["listaTL"] as System.Data.DataSet;
                                    foreach (System.Data.DataRow r in myDataSet.Tables[0].Rows)
                                    {
                                                        <tr>
                                                            <td>@r["IdTipoLogistica"]</td>
                                                            <td>@r["TipoLogistica"]</td>
                                                            <td>@r["MinPesoVolumetrico"]</td>
                                                            <td>@r["MaxPesoVolumetrico"]</td>
                                                            <td>@r["MaxCosto"]</td>
                                                            <td>@r["TipoCatalagos"]</td>
                                                            <td>@r["UsuarioCreacion"]</td>
                                                            <td>@r["FechaUltModif"]</td>
                                                            <td>@r["TimeUltModif"]</td>
                                                            @*<td>@r["BitActivo"]</td>*@
                                                            @if (r["BitActivo"].ToString() == "1")
                                                            {
                                                                <td>Activo</td>
                                                            }
                                                            else
                                                            {
                                                                <td>Inactivo</td>
                                                            }
                                                            @*<td>@r["Fecha"]</td>*@
                                                            <td>
                                                                <button type="button" title="Editar" onclick="SelectItem('@r["IdTipoLogistica"]','@r["IdTipoLogistica"]')" class="btn btn-white btn-circle"> <i class="fa fa-edit"></i></button>
                                                            </td>
                                                        </tr>

                                    }
                                }
                            }


                        </tbody>
                        @*<tfoot>
                                <tr>
                                    <th>DescripcionServicio</th>
                                    <th>TipoEnvioRes</th>
                                    <th>AplicaCotizacion</th>
                                    <th>TarifaBase</th>
                                    <th>CCTarifaBase</th>
                                    <th>CargosExtra</th>
                                    <th>SobrePeso</th>
                                    <th>CCSobrePeso</th>
                                    <th>CostoTotal</th>
                                    <th>Peso</th>
                                    <th>AplicaServicio</th>
                                </tr>
                            </tfoot>*@
                    </table>

                </div>
            </div>
        </div>


        <div id="frmAltaTrans" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="idTitulo" class="modal-title"></h2>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="frmCreateServicios">
                            @*<div class="row">
                                                                    <div class="col col-xs-8 col-md-12">
                                                                        <div class="form-group">
                                                                            <label>Transportista</label>
                                                                            <select class="form-control" id="ProveedorLista" name="ProveedorLista">
                                                                                <option selected="selected" value="0">--Transportista--</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                @Descripcion
                                                                @TipoCatalogo
                                                                @Id_TipoAlmacen
                                                                @Id_CategoriaArt
                                                                @Peso_min
                                                                @Peso_max

                                TipoLogistica
                                MinPesoVolumetrico
                                MaxPesoVolumetrico
                                MaxCosto
                                TipoArticulo


                                                                </div>*@
                            <div class="row">
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Tipo Logistica</label>
                                        <input type="text" placeholder="LOGISTICA" id="in_descripcion" name="in_descripcion" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Min. Peso Volumetrico</label>
                                        <input type="text" placeholder="Min. Peso Volumetrico" id="in_MinPesoVolumetrico" name="in_MinPesoVolumetrico" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Max. Peso Volumetrico</label>
                                        <input type="text" placeholder="Max. Peso Volumetrico" id="in_MaxPesoVolumetrico" name="in_MaxPesoVolumetrico" class="form-control" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Tipo Catalogo</label>
                                        <br />
                   
                                            <input name="tipoCatalogo" type="checkbox" value="grocery"/>
                                            <label for="tipoCatalogo" >Grocery</label>
                                        
                                            <input name="tipoCatalogo" type="checkbox" value="non-grocery"/>
                                            <label for="tipoCatalogo">Non-Grocery</label>
                                        

                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Max. Costo</label>
                                        <input type="text" placeholder="Max. Costo" id="in_MaxCosto" name="in_MaxCosto" class="form-control" />
                                    </div>
                                </div>
                                <div class="col col-xs-8 col-md-4">
                                    <div class="form-group">
                                        <label>Estatus</label>
                                        <select class="form-control" id="in_estatus" name="in_estatus">
                                            <option selected="selected" value="0">Activo</option>
                                            <option value="1">Inactivo</option>

                                        </select>
                                    </div>
                                </div>
                            </div>

                        </form>
                    </div>

                    <div class="modal-footer">

                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button type="button" onclick="AddSurtidores()" class="btn btn-primary">Guardar</button>
                    </div>

                </div>
            </div>
        </div>

        <div id="buscaOrden" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">Lista de Ordenes</h2>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <table id="Table_Inv" class="table table-striped table-bordered table-hover" style="overflow: scroll">
                            <thead>
                                <tr>
                                    <th>OrderNo</th>
                                    <th>UeNo</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>

                                @{

                                    if (Session["lisOrdenes"] != null)
                                    {

                                        var myDataSet = Session["lisOrdenes"] as System.Data.DataSet;
                                        foreach (System.Data.DataRow r in myDataSet.Tables[0].Rows)
                                        {
                                            <tr>
                                                <td>
                                                    @r["OrderNo"]
                                                </td>
                                                <td>
                                                    @r["UeNo"]
                                                </td>
                                                <td>
                                                    <button type="button" onclick="SelectOrder('@r["OrderNo"]','@r["UeNo"]')" class="btn btn-warning btn-circle"> <i class="fa fa-edit"></i></button>
                                                </td>
                                            </tr>

                                        }
                                    }
                                }

                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">

                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button type="button" onclick="AddSurtidores()" class="btn btn-primary">Guardar</button>
                    </div>

                </div>
            </div>
        </div>


        <div class="modal fade bd-example-modal-lg" id="myProduccion" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="height:650px">
                    <div class="modal-header">
                        <h5 class="modal-title">Reporte de Consulta de Asignacion de Dueño de Pasillo</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <iframe width="100%" height="550px" id="frameReporte" src="" frameborder="0" allowfullscreen></iframe>

                    </div>

                </div>
            </div>
        </div>


        <div class="modal fade bd-example-modal-lg" id="dlgReporteador" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="titleReporteador">Mostrando el reporte</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div style="position:inherit">
                            <div class="lockPdf"></div>
                            <embed class="modalPdfContainer" src="data:application/pdf;base64,'" type="application/pdf" id="objPDF" />
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <input id="filename" name="filename" value="0" style="visibility:hidden" />

        <input id="flagStatus" name="flagStatus" value="0" style="visibility:hidden" />

    </div>
}
@section scripts {

    <link href="~/Content/plugins/datatables/datatables.css" rel="stylesheet" />
    <script src="~/Content/plugins/datatables/datatables.min.js"></script>
    <script src="~/Content/plugins/datatables/datatables.js"></script>
    <script src="~/Scripts/bootbox.js"></script>
    <script src="~/Scripts/bootbox.min.js"></script>

    <script>
        function changeSrcEmbed(element, src) {
            var id = element.id;
            element.src = src;
            var embedOld = document.getElementById(id);
            var parent = embedOld.parentElement;
            var newElement = element;
            document.getElementById(id).remove();
            //parent.append(newElement);
            parent.appendChild(newElement);

        }


        function SelectItem(item, itemID) {

             $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetTipoLogistica", "Catalogo")',
                data: {
                    IdTipoLogistica: item
                },
                datatype: "html",
                success: function (json) {
                    if (json.Success) {

                       // debugger;
                        checkedTipoCatalogo(json.tipoCat);
                        document.getElementById("flagStatus").value = json.Id;
                        document.getElementById("idTitulo").innerHTML  = 'Edición de Tipo de Logistica';
                        //document.getElementById("in_tipoEntrega").value = json.tl;
                        //document.getElementById("in_tipoCatalogo").value = json.tc;
                        //document.getElementById("tipoAlmacen").value = json.ta;
                        //document.getElementById("in_categoria").value = json.ca;
                        //document.getElementById("in_pesoMin").value = json.pm;
                        //document.getElementById("in_pesoMax").value = json.pmx;
                        //document.getElementById("in_estatus").value = json.e;

                        //Id = out_IdTipoLogistica, tl = TipoLogistica, mp = MinPesoVolumetrico, mxp = MaxPesoVolumetrico, ta = TipoArticulo, mx = MaxCosto, e 

                            document.getElementById("in_descripcion").value = json.tl;
                            document.getElementById("in_MinPesoVolumetrico").value = json.mp;
                            document.getElementById("in_MaxPesoVolumetrico").value = json.mxp;
                            document.getElementById("in_MaxCosto").value = json.mx;
                            document.getElementById("in_tipoArticulo").value = json.ta;
                        document.getElementById("in_estatus").value = json.e;
                        
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
             });



            $("#frmAltaTrans").modal('show');





        }

        function SelectOrder(orden,ue) {

            document.getElementById("NoOrder").value = orden;
            document.getElementById("UeNo").value = ue;

            $("#buscaOrden").modal('hide');
        }

        function btnOrdenes() {

            $("#buscaOrden").modal('show');

        }

        $('#radioBtn a').on('click', function () {
            var sel = $(this).data('title');
            var tog = $(this).data('toggle');
            $('#' + tog).prop('value', sel);

            $('a[data-toggle="' + tog + '"]').not('[data-title="' + sel + '"]').removeClass('active').addClass('notActive');
            $('a[data-toggle="' + tog + '"][data-title="' + sel + '"]').removeClass('notActive').addClass('active');
        })

        function checkedTipoCatalogo(item)
        {
            var checkboxes = document.getElementsByName('tipoCatalogo');
            //inicializa los checks
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].checked)
                    checkboxes[i].checked = false;
            }

            var _array = item.split(',');
            //console.log(_array);
            
            var selected = [];
            _array.forEach(x => {
                for (var i = 0; i < checkboxes.length; i++) {
                    console.log(checkboxes[i]);
                    if (checkboxes[i].value == x)
                        checkboxes[i].checked = true;
                }
            });
            

        }

        $(document).ready(function () {

            //var checkboxes = document.getElementsByName('tipoCatalogo');
            //var selected = [];
            //for (var i = 0; i < checkboxes.length; i++) {
            //    console.log(checkboxes[i]);
            //    if (checkboxes[i].value == 'grocery')
            //        checkboxes[i].checked = true;
            //    //if (checkboxes[i].checked) {
            //    //    selected.push(checkboxes[i].value);
            //    //}
            //}
            $('input[type=checkbox]').change(function () { alert(document.getElementById("id_TS").value) });

            $('#Table_Inv').DataTable(
                {

                    language:
                    {
                        "sProcessing": "Procesando...",
                        "sLengthMenu": "Mostrar _MENU_ registros",
                        "sZeroRecords": "No se encontraron resultados",
                        "sEmptyTable": "Ningún dato disponible en esta tabla",
                        "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "sInfoPostFix": "",
                        "sSearch": "Buscar:",
                        "sUrl": "",
                        "sInfoThousands": ",",
                        "sLoadingRecords": "Cargando...",
                        "oPaginate": {
                            "sFirst": "Primero",
                            "sLast": "Último",
                            "sNext": "Siguiente",
                            "sPrevious": "Anterior"

                        },
                        "oAria": {
                            "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sSortDescending": ": Activar para ordenar la columna de manera descendente"

                        },
                        "buttons": {
                            "print": "Imprimir",
                            "pageLength": 'Mostrar %d Registros'

                        }
                    },
                    dom: 'Bfrtip',
                    lengthMenu: [
                        [10, 25, 50, -1],
                        ['10 Registros', '25 Registros', '50 Registros', 'Mostrar Todos']
                    ],
                    buttons: [
                        { extend: 'pageLength', className: 'btn-primary' },
                        { extend: 'excel', className: 'btn-primary' }

                    ]
                    //,"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    //    if (aData[1] == "SETC") {
                    //        $('td', nRow).css('background-color', '#B6BF00');
                    //    } else if (aData[2] == "4") {
                    //        $('td', nRow).css('background-color', 'Orange');
                    //    }
                    //}
                }
            );

            $('#tblConsulta thead tr').clone(true).appendTo('#tblConsulta thead');
            $('#tblConsulta thead tr:eq(0) th').each(function (i) {
                if ($(this).attr('name') != "accion") {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form form-control input-sm" placeholder="' + title + '" />');

                    $('input', this).on('keyup change', function () {
                        if (table.column(i).search() !== this.value) {
                            table
                                .column(i)
                                .search(this.value)
                                .draw();
                        }
                    });
                } else {
                    $(this).empty();
                }
            });

            table = $('#tblConsulta').DataTable(
                {

                    language:
                        {
                            "sProcessing": "Procesando...",
                            "sLengthMenu": "Mostrar _MENU_ registros",
                            "sZeroRecords": "No se encontraron resultados",
                            "sEmptyTable": "Ningún dato disponible en esta tabla",
                            "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                            "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                            "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                            "sInfoPostFix": "",
                            "sSearch": "Buscar:",
                            "sUrl": "",
                            "sInfoThousands": ",",
                            "sLoadingRecords": "Cargando...",
                            "oPaginate": {
                                "sFirst": "Primero",
                                "sLast": "Último",
                                "sNext": "Siguiente",
                                "sPrevious": "Anterior"

                            },
                            "oAria": {
                                "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                                "sSortDescending": ": Activar para ordenar la columna de manera descendente"

                            },
                            "buttons": {
                                "print": "Imprimir",
                                "pageLength": 'Mostrar %d Registros'

                            }
                        },
                    dom: 'Bfrtip',
                    lengthMenu: [
                                    [10, 25, 50, -1],
                                     ['10 Registros', '25 Registros', '50 Registros', 'Mostrar Todos']
                    ],
                    buttons: [
                            { extend: 'pageLength', className: 'btn-primary' },
                            { extend: 'excel', className: 'btn-primary' },
                            {
                                text: 'Alta',
                                action: function (e, dt, node, config) {
                                    //var e = document.getElementById("ProveedorLista");
                                    //e.disabled = false;

                                    //document.getElementById("TarifaFija").value = "SI";
                                    //document.getElementById("cp_origen").value = '';
                                    //document.getElementById("cp_destino").value = '';
                                    //document.getElementById("in_ancho").value = '';
                                    //document.getElementById("in_alto").value = '';
                                    //document.getElementById("in_peso").value = '';
                                    //document.getElementById("in_largo").value = '';
                                    document.getElementById("idTitulo").innerHTML = 'Alta de Tipo de Logistica';
                                    document.getElementById("flagStatus").value = "0";
                                    $("#frmAltaTrans").modal('show');

                                }
                                , className: 'btn-primary'
                            }
                    ]
                    //,"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                    //    if (aData[1] == "SETC") {
                    //        $('td', nRow).css('background-color', '#B6BF00');
                    //    } else if (aData[2] == "4") {
                    //        $('td', nRow).css('background-color', 'Orange');
                    //    }
                    //}
                }
            );
        });

        function GetCommonProveedor() {

            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetCommonProveedores", "Catalogo")',
                data: {
                    IdAlmacen: null
                },
                datatype: "html",
                success: function (json) {
                    if (json.Success) {
                        console.log(json);
                        var dynamicSelect = document.getElementById("ProveedorLista");
                        dynamicSelect.innerText = null;
                        console.log(dynamicSelect);
                        for (var i = 0; i < json.json.length; i++) {
                            var newOption = document.createElement("option");
                            newOption.value = json.json[i].NumProveedor;
                            newOption.textContent = json.json[i].NombreProveedor;//item.whateverProperty

                            dynamicSelect.appendChild(newOption);
                        }
                        console.log(dynamicSelect);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function EditSurtidores(IdTransportista) {

            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetTransportistas", "Catalogo")',
                data: {
                    IdTransportista: parseInt(IdTransportista)
                },
                datatype: "html",
                success: function (json) {
                    //debugger;
                    if (json.Success) {
                        console.log(json);
                        for (var i = 0; i < json.json.length; i++) {
                            //document.getElementById("IdTransportista").value = json.json[i].IdTransportista;
                            //document.getElementById("RazonSocial").value = json.json[i].RazonSocial;
                            var e = document.getElementById("ProveedorLista");
                            e.value = json.json[i].IdTransportista;
                            e.disabled = true;

                            var valTarifaFija = (json.json[i].TarifaFija == true) ? "Y" : "N";
                            document.getElementById("CostoTarifaFija").value = json.json[i].CostoTarifaFija;
                            document.getElementById("NivelServicio").value = json.json[i].NivelServicio;
                            document.getElementById("FactorVoluntario").value = json.json[i].FactorVoluntario;
                            document.getElementById("PorcAdicPaquete").value = json.json[i].PorcAdicPaquete;
                            document.getElementById("Prioridad").value = json.json[i].Prioridad;
                            var valPaqueteria = (json.json[i].Paqueteria == true) ? "Y" : "N";
                            var valBigTicket = (json.json[i].BigTicket == true) ? "Y" : "N";
                            var valServicioEstandar = (json.json[i].ServicioEstandar == true) ? "Y" : "N";
                            var valServicioExpress = (json.json[i].ServicioExpress == true) ? "Y" : "N";
                        }

                        $('a[data-toggle="TarifaFija"][data-title="' + valTarifaFija + '"]').click();
                        $('a[data-toggle="Paqueteria"][data-title="' + valPaqueteria + '"]').click();
                        $('a[data-toggle="BigTicket"][data-title="' + valBigTicket + '"]').click();
                        $('a[data-toggle="ServicioEstandar"][data-title="' + valServicioEstandar + '"]').click();
                        $('a[data-toggle="ServicioExpress"][data-title="' + valServicioExpress + '"]').click();

                        $("#frmAltaTrans").modal('show');
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function AddSurtidores() {
           /* var _TarifaFija = document.getElementById("TarifaFija").value;*/
            var checkboxes = document.querySelectorAll('input[name="tipoCatalogo"]:checked'), values = [];
            Array.prototype.forEach.call(checkboxes, function (el) {
                values.push(el.value);
            });
            console.log(values);
            var count = 1;
            var _tipoCat = '';

            values.forEach(x => {

                if (count > 1)
                    _tipoCat = _tipoCat + ',' + x;
                else
                    _tipoCat = x;

                count++;
            });
        
            //alert(_tipoCat);
            $.ajax({
                async: false,
                type: "POST",
                url: '@Url.Action("InsTipoLogistica", "Catalogo")',
                data: {
                    IdTipoLogistica : document.getElementById("flagStatus").value,
                    TipoLogistica: document.getElementById("in_descripcion").value,
                    MinPesoVolumetrico: document.getElementById("in_MinPesoVolumetrico").value,
                    MaxPesoVolumetrico: document.getElementById("in_MaxPesoVolumetrico").value,
                    MaxCosto: document.getElementById("in_MaxCosto").value,
                    estatus: document.getElementById("in_estatus").value,
                    tipoCatalago: _tipoCat == '' ? null : _tipoCat
                },
                datatype: "json",
                success: function (json) {
                    if (json.Success) {
                        debugger;
                        //alert(json.json.cotizacion.TipoServicio[0].DescripcionServicio);

                        //var table1 = $('#tblConsulta').DataTable();
                        //table1.clear().draw();
                        //table1.destroy();


                        //var table = $('#tblConsulta').DataTable(
                        //    {

                        //        language:
                        //        {
                        //            "sProcessing": "Procesando...",
                        //            "sLengthMenu": "Mostrar _MENU_ registros",
                        //            "sZeroRecords": "No se encontraron resultados",
                        //            "sEmptyTable": "Ningún dato disponible en esta tabla",
                        //            "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        //            "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        //            "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                        //            "sInfoPostFix": "",
                        //            "sSearch": "Buscar:",
                        //            "sUrl": "",
                        //            "sInfoThousands": ",",
                        //            "sLoadingRecords": "Cargando...",
                        //            "oPaginate": {
                        //                "sFirst": "Primero",
                        //                "sLast": "Último",
                        //                "sNext": "Siguiente",
                        //                "sPrevious": "Anterior"

                        //            },
                        //            "oAria": {
                        //                "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                        //                "sSortDescending": ": Activar para ordenar la columna de manera descendente"

                        //            },
                        //            "buttons": {
                        //                "print": "Imprimir",
                        //                "pageLength": 'Mostrar %d Registros'

                        //            }
                        //        },
                        //        dom: 'Bfrtip',
                        //        lengthMenu: [
                        //            [10, 25, 50, -1],
                        //            ['10 Registros', '25 Registros', '50 Registros', 'Mostrar Todos']
                        //        ],
                        //        buttons: [
                        //            { extend: 'pageLength', className: 'btn-primary' },
                        //            { extend: 'excel', className: 'btn-primary' },
                        //            {
                        //                text: 'Cotizacion',
                        //                action: function (e, dt, node, config) {
                        //                    //var e = document.getElementById("ProveedorLista");
                        //                    //e.disabled = false;

                        //                    //document.getElementById("TarifaFija").value = "SI";
                        //                    //document.getElementById("cp_origen").value = '';
                        //                    //document.getElementById("cp_destino").value = '';
                        //                    //document.getElementById("in_ancho").value = '';
                        //                    //document.getElementById("in_alto").value = '';
                        //                    //document.getElementById("in_peso").value = '';
                        //                    //document.getElementById("in_largo").value = '';

                        //                    $("#frmAltaTrans").modal('show');

                        //                }
                        //                , className: 'btn-primary'
                        //            },
                        //            {
                        //                text: 'Guardar Cotizacion',
                        //                action: function (e, dt, node, config) {
                        //                    saveCotizacion()
                        //                }
                        //                , className: 'btn-primary'
                        //            }

                        //        ]
                        //        //,"fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                        //        //    if (aData[1] == "SETC") {
                        //        //        $('td', nRow).css('background-color', '#B6BF00');
                        //        //    } else if (aData[2] == "4") {
                        //        //        $('td', nRow).css('background-color', 'Orange');
                        //        //    }
                        //        //}
                        //    }
                        //);

                        ////table.clear().draw();
                        ////table.destroy();

                        //for (var i = 0; i < json.json.cotizacion.TipoServicio.length; i++) {


                        //    table.row.add([
                        //        json.json.cotizacion.TipoServicio[i].DescripcionServicio,
                        //        json.json.cotizacion.TipoServicio[i].TipoEnvioRes,
                        //        json.json.cotizacion.TipoServicio[i].AplicaCotizacion,
                        //        json.json.cotizacion.TipoServicio[i].TarifaBase,
                        //        json.json.cotizacion.TipoServicio[i].CCTarifaBase,
                        //        json.json.cotizacion.TipoServicio[i].CargosExtra,
                        //        json.json.cotizacion.TipoServicio[i].SobrePeso,
                        //        json.json.cotizacion.TipoServicio[i].CCSobrePeso,
                        //        json.json.cotizacion.TipoServicio[i].CostoTotal,
                        //        json.json.cotizacion.TipoServicio[i].Peso,
                        //        json.json.cotizacion.TipoServicio[i].AplicaServicio
                        //        /*, "<input id=\"radio_TS\" name=\"tipoS\" type=\"radio\" onchange=\"setTS('" + json.json.cotizacion.TipoServicio[i].DescripcionServicio + "')\"  value=\"" + json.json.cotizacion.TipoServicio[i].DescripcionServicio + "\">"*/
                        //        /*, "<button type=\"button\" onclick=\"DeleteSurtidores(undefined)\" class=\"btn btn-warning btn-circle\"> <i class=\"fa fa-pencil\"></i></button>"*/
                        //        , "<button type=\"button\" onclick=\"GeneraGuia(" + json.json.cotizacion.TipoServicio[i].DescripcionServicio+")\" class=\"btn btn-warning btn-circle\"> <i class=\"fa fa-pencil\"></i></button>"

                        //    ]).draw();

                        //}


                        $("#frmAltaTrans").modal('hide');
                        location.reload();

                    } else { alert(json.Message);}
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function GeneraGuia(desc) {

             $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GeneraGuia", "TMS")',
                data: {
                    UeNo: document.getElementById("UeNo").value,
                    OrderNo: document.getElementById("NoOrder").value,
                    tipoServicio: desc, //document.getElementById("flagStatus").value,
                    paqueteria: "1"

                },
                datatype: "html",
                success: function (json) {
                    //debugger;
                    if (json.Success) {

                        alert("Cotizacion Guardada con exito");


                        @*$('#frameReporte').attr('src', '@Url.Action("DownLoad", "IntegridadAnaquel")?filename=' + data.Object.ruta);

                        $('#myProduccion').modal('show');*@


                        var element = document.getElementById('objPDF');
                        changeSrcEmbed(element, 'data:application/pdf;base64,' + json.pdf);//+ '#toolbar=0&navpanes=0&scrollbar=0');
                        $('#dlgReporteador').modal('show');
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        function DisplayError(xhr) {

            if (xhr.responseText == "Solicitud incorrecta") {
                var msg = JSON.parse(xhr.statusText);
                bootbox.alert("<h4>" + msg + "</h4>");
            }
            else {
                var msg = JSON.parse(xhr.responseText);
                bootbox.alert("<h4>" + msg.Message + "</h4>");
            }
        }


        function setTS(servicio) {

            //$('input:checkbox').prop('checked', false)
            debugger;
            var nameChk = "#chk_" + document.getElementById("flagStatus").value.replace(/\s+/g, '');

            $(nameChk).prop("checked", false);

            document.getElementById("flagStatus").value = servicio;

        }

        function articulo(codigo, descripcion, unidad) {
            this.Codigo = codigo;
            this.Descripcion = descripcion;
            this.Unidad = unidad;
        }

        function captura(guid, codigo, cantidad) {
            this.idCaptura = 0;
            this.guid = guid;
            this.Codigo = codigo;
            this.Cantidad = cantidad;
        }


        function cotizacion(DescripcionServicio
                            ,TipoEnvioRes
                            ,AplicaCotizacion
                            ,TarifaBase
                            ,CCTarifaBase
                            ,CargosExtra
                            ,SobrePeso
                            ,CCSobrePeso
                            ,CostoTotal
                            ,Peso
                            ,AplicaServicio) {

            this.DescripcionServicio = DescripcionServicio
            this.TipoEnvioRes = TipoEnvioRes
            this.AplicaCotizacion = AplicaCotizacion
            this.TarifaBase = TarifaBase
            this.CCTarifaBase = CCTarifaBase
            this.CargosExtra = CargosExtra
            this.SobrePeso = SobrePeso
            this.CCSobrePeso = CCSobrePeso
            this.CostoTotal = CostoTotal
            this.Peso = Peso
            this.AplicaServicio = AplicaServicio

        }

        function saveCotizacion() {

            debugger;

            alert("TS" + document.getElementById("flagStatus").value);


            var dtTable12 = $('#tblConsulta').DataTable();

            var catalogo = [];
            var capturas = [];

            dtTable12.rows().data().toArray().forEach(function (row) {
                var item = {}
                debugger;
                lastInventoryCapture = new cotizacion(row[0]
                            , row[1]
                            , row[2]
                            , row[3]
                            , row[4]
                            , row[5]
                            , row[6]
                            , row[7]
                            , row[8]
                            , row[9]
                            , row[10]);

                capturas.push(lastInventoryCapture);

                //var indexC = 0;
                //row.forEach(function (content, index) {
                //    item[fieldNames[index]] = content;


                //    indexC++;
                //})
                //json2.push(item)
            })
            debugger;
            //alert('capturas' + JSON.stringify(capturas));

            //var data = dtTable12.rows().data().toArray();
            //var json = JSON.stringify(data);

            //alert(json);

            //alert($('#tblConsulta').DataTable().rows().data().toArray());


            @*$.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("SaveCotizacion", "TMS")',
                data: {
                    jsonData: JSON.stringify(capturas)
                },
                datatype: "html",
                success: function (json) {
                    //debugger;
                    if (json.Success) {

                        alert("Cotizacion Guardada con exito");

                    }
                }
               , error: function (jqXHR, textStatus, errorThrown) {
                   bootbox.alert(errorThrown);
               }
            });*@

        }



        //<th>Id Transportista</th>
        //<th>Tarifa Fija</th>
        //<th>Prioridad</th>
        //<th>Nivel de Servicio</th>
        //<th>Factor Division<br /> Peso Voluntario </th>
        //<th>Paqueteria</th>
        //<th>Big Ticket</th>
        //<th>Servicio Estandar</th>
        //<th>Servicio Express</th>
        function GetTrans() {
            //var _Id_Num_UN = $("#hddTda").val();
            //debugger;
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetTransportistas", "Catalogo")',
                data: {
                    //  Id_Num_UN: _Id_Num_UN
                },
                datatype: "html",
                success: function (json) {
                    if (json.Success) {
                        $("#tblConsulta tbody tr").remove();
                        //var tr;
                        //debugger;
                        //Append each row to html table
                        console.log(json);
                        for (var i = 0; i < json.json.length; i++) {
                            tr = $('<tr/>');
                            //tr.append("<td class='row1'>" + json.json[i].Id_Num_Orden + "</td>");
                            tr.append("<td>" + json.json[i].IdTransportista + "</td>");
                            //tr.append("<td>" + json.json[i].RazonSocial + "</td>");
                            if (json.json[i].TarifaFija == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }

                            tr.append("<td>" + json.json[i].Prioridad + "</td>");
                            tr.append("<td>" + json.json[i].NivelServicio + "</td>");
                            tr.append("<td>" + json.json[i].FactorPaqueteria + "</td>");
                            if (json.json[i].Paqueteria == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            if (json.json[i].BigTicket == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            if (json.json[i].ServicioEstandar == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            if (json.json[i].ServicioExpress == true) {
                                tr.append("<td><input type=\"checkbox\" class=\"editor - active\" onclick=\"return false;\" checked></td>");
                            }
                            else {
                                tr.append("<td><input type=\"checkbox\" onclick=\"return false;\" class=\"editor - active\"></td>");
                            }
                            //tr.append("<td><button type = 'button' class= 'btn btn-white btn-circle'> <i class='fa fa-edit'></i></button><button type='button' class='btn btn-warning btn-circle'> <i class='fa fa-minus'></i></button></td >")
                            tr.append("<td><button onclick='EditSurtidores(" + json.json[i].IdTransportista + ")' type = 'button' class= 'btn btn-white btn-circle'> <i class='fa fa-edit'></i></button><button type='button'  onclick='DeleteSurtidores(" + json.json[i].Id_Carrier + ")'  class='btn btn-warning btn-circle'> <i class='fa fa-minus'></i></button></td >")
                            $('#tblConsulta').append(tr);

                        }
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }
            });
        }

        /* Bootbox Dialog box with custom Value */
        $('.alert-custom').click(function () {
            bootbox.dialog({
                title: "This is a form in a modal.",
                message: '<div class="row">  ' +
                '<div class="col-md-12"> ' +
                '<form class="form-horizontal"> ' +
                '<div class="form-group"> ' +
                '<label class="col-md-4 control-label" for="name">Name</label> ' +
                '<div class="col-md-4"> ' +
                '<input id="name" name="name" type="text" placeholder="Your name" class="form-control input-md"> ' +
                '<span class="help-block">Here goes your name</span> </div> ' +
                '</div> ' +
                '<div class="form-group"> ' +
                '<label class="col-md-4 control-label" for="awesomeness">How awesome is this?</label> ' +
                '<div class="col-md-4"> <div class="radio"> <label for="awesomeness-0"> ' +
                '<input type="radio" name="awesomeness" id="awesomeness-0" value="Really awesome" checked="checked"> ' +
                'Really awesome </label> ' +
                '</div><div class="radio"> <label for="awesomeness-1"> ' +
                '<input type="radio" name="awesomeness" id="awesomeness-1" value="Super awesome"> Super awesome </label> ' +
                '</div> ' +
                '</div> </div>' +
                '</form> </div>  </div>',
                buttons: {
                    success: {
                        label: "Save",
                        className: "btn-success",
                        callback: function () {
                            var name = $('#name').val();
                            var answer = $("input[name='awesomeness']:checked").val()
                            $('.Example').show().html("Hello " + name + ". You've chosen <b>" + answer + "</b").fadeOut(5000);
                        }
                    }
                }
            }
                    );
        })
    </script>
}
